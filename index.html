<!DOCTYPE html>

<head>
    <title>Dyno Prototype</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

</head>

<body>
    <h4>Peak HP: <span id="php"></span></h4>
    <h4>Peak TQ: <span id="ptq"></span></h4>
    <div>
        <canvas id="myChart" style="margin: 10px;"></canvas>
    </div>
    <br>
    <br>
    <div id="chart"></div>
    <!-- <input type="file" id="fileinput" /> -->
    <!-- <button id="button">Load</button> -->
</body>

<script>
    // === include 'setup' then 'config' above ===
    // const DATA_COUNT = 7;
    // const NUMBER_CFG = { count: DATA_COUNT, min: -100, max: 100 };

    //const labels = Utils.months({ count: 7 });
    // let whp;
    // let tq;
    // let rpm;
    //let res;
    let data = '[{"rpm":"2251","whp":"80","wftlb":"187"},{"rpm":"2279","whp":"92","wftlb":"211"},{"rpm":"2248","whp":"93","wftlb":"217"},{"rpm":"2284","whp":"96","wftlb":"220"},{"rpm":"2301","whp":"98","wftlb":"224"},{"rpm":"2318","whp":"101","wftlb":"229"},{"rpm":"2351","whp":"105","wftlb":"234"},{"rpm":"2351","whp":"107","wftlb":"239"},{"rpm":"2394","whp":"112","wftlb":"246"},{"rpm":"2398","whp":"115","wftlb":"251"},{"rpm":"2434","whp":"119","wftlb":"257"},{"rpm":"2452","whp":"123","wftlb":"263"},{"rpm":"2474","whp":"127","wftlb":"270"},{"rpm":"2500","whp":"131","wftlb":"276"},{"rpm":"2508","whp":"136","wftlb":"286"},{"rpm":"2528","whp":"142","wftlb":"294"},{"rpm":"2555","whp":"147","wftlb":"303"},{"rpm":"2591","whp":"155","wftlb":"313"},{"rpm":"2622","whp":"162","wftlb":"324"},{"rpm":"2641","whp":"167","wftlb":"333"},{"rpm":"2648","whp":"173","wftlb":"344"},{"rpm":"2687","whp":"182","wftlb":"356"},{"rpm":"2723","whp":"192","wftlb":"370"},{"rpm":"2784","whp":"203","wftlb":"383"},{"rpm":"2850","whp":"217","wftlb":"399"},{"rpm":"2898","whp":"228","wftlb":"413"},{"rpm":"2868","whp":"234","wftlb":"429"},{"rpm":"2825","whp":"240","wftlb":"447"},{"rpm":"2881","whp":"252","wftlb":"460"},{"rpm":"2937","whp":"262","wftlb":"468"},{"rpm":"2969","whp":"268","wftlb":"474"},{"rpm":"2980","whp":"270","wftlb":"476"},{"rpm":"3038","whp":"276","wftlb":"478"},{"rpm":"3082","whp":"284","wftlb":"484"},{"rpm":"3124","whp":"288","wftlb":"485"},{"rpm":"3137","whp":"288","wftlb":"483"},{"rpm":"3188","whp":"294","wftlb":"485"},{"rpm":"3250","whp":"300","wftlb":"485"},{"rpm":"3250","whp":"301","wftlb":"487"},{"rpm":"3277","whp":"301","wftlb":"483"},{"rpm":"3339","whp":"302","wftlb":"476"},{"rpm":"3372","whp":"308","wftlb":"479"},{"rpm":"3421","whp":"313","wftlb":"480"},{"rpm":"3452","whp":"314","wftlb":"477"},{"rpm":"3481","whp":"318","wftlb":"480"},{"rpm":"3511","whp":"319","wftlb":"478"},{"rpm":"3542","whp":"323","wftlb":"479"},{"rpm":"3576","whp":"326","wftlb":"479"},{"rpm":"3626","whp":"332","wftlb":"481"},{"rpm":"3652","whp":"337","wftlb":"485"},{"rpm":"3691","whp":"343","wftlb":"488"},{"rpm":"3731","whp":"347","wftlb":"488"},{"rpm":"3791","whp":"355","wftlb":"492"},{"rpm":"3814","whp":"358","wftlb":"493"},{"rpm":"3861","whp":"363","wftlb":"494"},{"rpm":"3890","whp":"366","wftlb":"494"},{"rpm":"3927","whp":"371","wftlb":"497"},{"rpm":"3979","whp":"378","wftlb":"499"},{"rpm":"3994","whp":"381","wftlb":"501"},{"rpm":"4032","whp":"383","wftlb":"499"},{"rpm":"4112","whp":"393","wftlb":"502"},{"rpm":"4156","whp":"398","wftlb":"503"},{"rpm":"4158","whp":"398","wftlb":"503"},{"rpm":"4180","whp":"399","wftlb":"502"},{"rpm":"4247","whp":"408","wftlb":"504"},{"rpm":"4293","whp":"413","wftlb":"505"},{"rpm":"4317","whp":"417","wftlb":"508"},{"rpm":"4342","whp":"425","wftlb":"514"},{"rpm":"4387","whp":"431","wftlb":"516"},{"rpm":"4437","whp":"439","wftlb":"520"},{"rpm":"4471","whp":"443","wftlb":"521"},{"rpm":"4507","whp":"451","wftlb":"525"},{"rpm":"4543","whp":"459","wftlb":"530"},{"rpm":"4587","whp":"466","wftlb":"533"},{"rpm":"4637","whp":"475","wftlb":"538"},{"rpm":"4650","whp":"479","wftlb":"541"},{"rpm":"4693","whp":"490","wftlb":"548"},{"rpm":"4742","whp":"495","wftlb":"548"},{"rpm":"4789","whp":"501","wftlb":"550"},{"rpm":"4842","whp":"501","wftlb":"543"},{"rpm":"4873","whp":"514","wftlb":"553"},{"rpm":"4881","whp":"518","wftlb":"557"},{"rpm":"4912","whp":"523","wftlb":"559"},{"rpm":"4972","whp":"532","wftlb":"563"},{"rpm":"5019","whp":"542","wftlb":"568"},{"rpm":"5042","whp":"547","wftlb":"570"},{"rpm":"5102","whp":"555","wftlb":"572"},{"rpm":"5135","whp":"551","wftlb":"564"},{"rpm":"5171","whp":"556","wftlb":"565"},{"rpm":"5169","whp":"557","wftlb":"566"},{"rpm":"5219","whp":"564","wftlb":"568"},{"rpm":"5287","whp":"565","wftlb":"561"},{"rpm":"5308","whp":"570","wftlb":"564"},{"rpm":"5332","whp":"574","wftlb":"565"},{"rpm":"5359","whp":"577","wftlb":"565"},{"rpm":"5425","whp":"582","wftlb":"563"},{"rpm":"5491","whp":"588","wftlb":"563"},{"rpm":"5497","whp":"587","wftlb":"561"},{"rpm":"5479","whp":"587","wftlb":"563"},{"rpm":"5547","whp":"587","wftlb":"556"},{"rpm":"5591","whp":"598","wftlb":"562"},{"rpm":"5626","whp":"597","wftlb":"558"},{"rpm":"5648","whp":"600","wftlb":"558"},{"rpm":"5699","whp":"608","wftlb":"560"},{"rpm":"5730","whp":"609","wftlb":"558"},{"rpm":"5765","whp":"612","wftlb":"558"},{"rpm":"5801","whp":"616","wftlb":"557"},{"rpm":"5839","whp":"611","wftlb":"550"},{"rpm":"5869","whp":"615","wftlb":"550"},{"rpm":"5889","whp":"618","wftlb":"551"},{"rpm":"5889","whp":"618","wftlb":"551"},{"rpm":"5952","whp":"620","wftlb":"547"},{"rpm":"5950","whp":"624","wftlb":"551"},{"rpm":"5998","whp":"625","wftlb":"547"},{"rpm":"6075","whp":"628","wftlb":"543"},{"rpm":"6100","whp":"628","wftlb":"540"},{"rpm":"6083","whp":"629","wftlb":"543"},{"rpm":"6138","whp":"637","wftlb":"545"},{"rpm":"6183","whp":"629","wftlb":"534"},{"rpm":"6232","whp":"636","wftlb":"536"},{"rpm":"6258","whp":"646","wftlb":"542"},{"rpm":"6268","whp":"641","wftlb":"537"},{"rpm":"6279","whp":"643","wftlb":"538"},{"rpm":"6279","whp":"643","wftlb":"538"},{"rpm":"6345","whp":"649","wftlb":"537"},{"rpm":"6348","whp":"644","wftlb":"533"},{"rpm":"6386","whp":"647","wftlb":"532"},{"rpm":"6405","whp":"650","wftlb":"533"},{"rpm":"6432","whp":"649","wftlb":"530"},{"rpm":"6480","whp":"647","wftlb":"524"},{"rpm":"6545","whp":"653","wftlb":"524"},{"rpm":"6539","whp":"654","wftlb":"525"},{"rpm":"6545","whp":"657","wftlb":"527"},{"rpm":"6553","whp":"658","wftlb":"528"},{"rpm":"6620","whp":"660","wftlb":"524"},{"rpm":"6640","whp":"660","wftlb":"522"},{"rpm":"6640","whp":"654","wftlb":"517"},{"rpm":"6679","whp":"655","wftlb":"515"},{"rpm":"6702","whp":"656","wftlb":"514"},{"rpm":"6727","whp":"661","wftlb":"516"},{"rpm":"6787","whp":"658","wftlb":"509"},{"rpm":"6797","whp":"656","wftlb":"507"},{"rpm":"6809","whp":"658","wftlb":"508"},{"rpm":"6812","whp":"661","wftlb":"510"},{"rpm":"6837","whp":"663","wftlb":"510"},{"rpm":"6887","whp":"660","wftlb":"503"},{"rpm":"6912","whp":"660","wftlb":"501"},{"rpm":"6944","whp":"657","wftlb":"497"},{"rpm":"6961","whp":"658","wftlb":"497"},{"rpm":"6961","whp":"658","wftlb":"497"},{"rpm":"6980","whp":"669","wftlb":"503"}]'



    function readSingleFile(evt) {
        var f = evt.target.files[0];
        if (f) {
            var r = new FileReader();
            r.onload = function (e) {
                var contents = e.target.result;
                var array = contents.toString().split("\r\n");
                let result = [];
                let headers = array[0].split(",")
                console.log(headers)
                for (let i = 1; i < array.length - 1; i++) {
                    let obj = {}
                    let str = array[i].split(',')
                    obj.rpm = str[0];
                    obj.whp = str[1];
                    obj.wftlb = str[2]

                    result.push(obj)
                }
                let json = JSON.stringify(result);
                res = result


                //myChart.update();

                // const myChart = new Chart(
                //     document.getElementById('myChart'),
                //     config
                // );
                console.log(json)
            }
            r.readAsText(f);
            //document.write(output);
        } else {
            alert("Failed to load file");
        }
    }
    //document.getElementById('fileinput').addEventListener('change', readSingleFile);
    //document.getElementById('button').addEventListener('click', () => {
    let res = JSON.parse(data).filter((n, i) => i % 10 == 0)
    let rpm = res.map(r => parseInt(r.rpm));
    let tq = res.map(r => parseInt(r.wftlb));
    let stq = res.map(r => parseInt(r.wftlb) - 50);
    let whp = res.map(r => parseInt(r.whp));
    let swhp = res.map(r => parseInt(r.whp) - 50);
    let php = [...whp].sort();
    //console.log(php)
    let ptq = [...tq].sort();
    rpm.unshift(NaN)
    // document.getElementById('php').innerText = php[php.length-1]
    //document.getElementById('ptq').innerText = ptq[ptq.length-1]

    //console.log(config)
    const config = {
        type: 'line',
        data: {
            labels: rpm,
            datasets: [
                {
                    label: 'WHP',
                    data: whp,
                    yAxisID: 'y',
                    borderColor: 'rgb(255, 51, 51)',
                    //cubicInterpolationMode: 'monotone',
                    tension: .4,
                },
                {
                    label: 'TQ',
                    data: tq,
                    yAxisID: 'y1',
                    borderColor: 'rgb(0, 19, 255)',
                    tension: .4
                },
                {
                    label: 'Stock WHP',
                    data: swhp,
                    yAxisID: 'y',
                    borderColor: 'rgb(255, 173, 173)',
                    //cubicInterpolationMode: 'monotone',
                    tension: .4,
                },
                {
                    label: 'Stock TQ',
                    data: stq,
                    yAxisID: 'y1',
                    borderColor: 'rgb(178, 183, 255)',
                    tension: .4
                },
                // {
                //     label: 'RPM (x1000)',
                //     data: rpm,
                //     xAxisID: 'x',
                //     borderColor: 'rgb(75, 192, 0)',
                // }
            ]
        },
        options: {
            responsive: true,
            interaction: {
                mode: 'index',
                intersect: false,
            },
            stacked: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Dyno'
                }
            },
            legend: {
                display: false
            },
            scales: {
                x: {
                    type: 'linear',
                    display: true,
                    title: {
                        display: true,
                        text: 'RPM'
                    },
                },
                y: {
                    type: 'linear',
                    display: true,
                    title: {
                        display: true,
                        text: 'WHP'
                    },
                    //position: 'left',
                    suggestedMin: 0,
                    max: 1000,
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: 'TQ'
                    },
                    suggestedMin: 0,
                    suggestedMax: 1000,

                    // grid line settings
                    grid: {
                        drawOnChartArea: false, // only want the grid lines for one axis to show up
                    },
                },
            }

        },
    };
    let myChart = new Chart(
        document.getElementById('myChart'),
        config
    );

    //});
    var options = {
        chart: {
            type: 'line'
        },
        stroke: {
            curve: 'smooth',
            lineCap: 'round'
        },
        colors: ['#FF0000', '#0300FF', '#FF9A9A', '#9B9AFF' ],
        series: [
            {
                name: 'WHP',
                data: whp
            },
            {
                name: 'TQ',
                data: tq
            },
            {
                name: 'Stock WHP',
                data: swhp
            },
            {
                name: 'STQ',
                data: stq
            },

        ],
        yaxis: [
            {
                title: {
                    text: "Power (HP)"
                },
                min: 0,
                max: 1000,
                seriesName: 'WHP'
            },
            {
                opposite: true,
                title: {
                    text: "Torque (ftlbs)"
                },
                min: 0,
                max: 1000
            },
            {
                seriesName: 'WHP',
                show: false
            },
            {
                seriesName: 'TQ',
                show: false
            },
            
        ],
        xaxis: {
            categories: rpm,
            title: {
                text: 'RPM'
            },
            // min: 0,
            // max: 9000
        }
    }

    var chart = new ApexCharts(document.querySelector("#chart"), options);

    chart.render();

</script>

<style>
    .apexcharts-canvas {
        background-image: url('https://www.eurocharged.com/wp-content/uploads/2022/03/Eurocharged-logo-copy.png');
        background-repeat: no-repeat;
        /* background-attachment: fixed; */
        background-position: center;
        
    }
</style>

</html>